<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>双色球系统修复测试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #e0e0e0; border-radius: 5px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .pass { background-color: #f6ffed; border: 1px solid #b7eb8f; color: #52c41a; }
        .fail { background-color: #fff2f0; border: 1px solid #ffccc7; color: #ff4d4f; }
        .info { background-color: #e6f7ff; border: 1px solid #91d5ff; color: #1890ff; }
        button { padding: 8px 16px; margin: 5px; background-color: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #40a9ff; }
        #history-preview { max-height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; }
        .history-item { margin: 5px 0; padding: 5px; border-bottom: 1px dashed #eee; }
    </style>
</head>
<body>
    <h1>双色球系统修复测试</h1>
    
    <div class="test-section">
        <h2>1. 前端功能测试</h2>
        <button onclick="testFrontendFeatures()">测试前端功能</button>
        <div id="frontend-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 历史数据模拟</h2>
        <button onclick="generateTestHistory()">生成测试历史数据</button>
        <div id="history-preview"></div>
        <div id="history-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. 修复说明</h2>
        <div class="info">
            <h3>已修复的问题：</h3>
            <ul>
                <li>修复了历史数据API中的参数传递错误</li>
                <li>增强了爬虫的错误处理和日志记录</li>
                <li>增加了模拟数据量（从10条到60条）</li>
                <li>修复了前端函数重复调用的问题</li>
                <li>优化了数据源列表，移除了可能有CORS问题的API</li>
                <li>改进了前端的错误处理和用户提示</li>
            </ul>
            
            <h3>使用建议：</h3>
            <ul>
                <li>确保安装了Node.js环境</li>
                <li>使用<code>npm install</code>安装依赖</li>
                <li>使用<code>npm run dev</code>启动开发服务器</li>
                <li>首次使用时点击"更新历史数据"按钮</li>
                <li>如果爬虫仍然失败，系统会自动使用模拟数据</li>
            </ul>
        </div>
    </div>

    <script>
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }
        
        function testFrontendFeatures() {
            showResult('frontend-test-result', '测试中...', 'info');
            
            // 测试DOM元素访问
            const mockHistoryList = document.createElement('div');
            mockHistoryList.id = 'history-list';
            document.body.appendChild(mockHistoryList);
            
            // 模拟getHistoryNumbers函数的逻辑
            setTimeout(() => {
                // 模拟API响应
                const mockResponse = {
                    success: true,
                    numbers: generateMockTestData()
                };
                
                // 模拟displayHistoryNumbers函数
                const container = document.getElementById('history-list');
                if (mockResponse.numbers && mockResponse.numbers.length > 0) {
                    container.innerHTML = `<div class="pass">前端功能测试通过：成功模拟了${mockResponse.numbers.length}条历史数据</div>`;
                    showResult('frontend-test-result', '前端功能测试通过', 'pass');
                } else {
                    container.innerHTML = `<div class="fail">前端功能测试失败：没有数据</div>`;
                    showResult('frontend-test-result', '前端功能测试失败', 'fail');
                }
                
                // 清理
                setTimeout(() => {
                    document.body.removeChild(mockHistoryList);
                }, 3000);
            }, 1000);
        }
        
        function generateTestHistory() {
            const testData = generateMockTestData();
            const preview = document.getElementById('history-preview');
            preview.innerHTML = '';
            
            testData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <strong>期号：${item.issue}</strong> - ${item.date}<br>
                    红球：${item.red.join(', ')} | 蓝球：${item.blue}
                `;
                preview.appendChild(div);
            });
            
            showResult('history-test-result', `成功生成${testData.length}条测试历史数据`, 'pass');
        }
        
        function generateMockTestData() {
            const results = [];
            const today = new Date();
            
            for (let i = 0; i < 20; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i * 3);
                
                const issueDate = date.toISOString().slice(2, 10).replace(/-/g, '');
                const issue = `2024${issueDate}`;
                
                const red = [];
                while (red.length < 6) {
                    const num = Math.floor(Math.random() * 33) + 1;
                    if (!red.includes(num)) red.push(num);
                }
                red.sort((a, b) => a - b);
                
                const blue = Math.floor(Math.random() * 16) + 1;
                
                results.push({
                    issue,
                    red,
                    blue,
                    date: date.toISOString().split('T')[0]
                });
            }
            
            return results;
        }
    </script>
</body>
</html>